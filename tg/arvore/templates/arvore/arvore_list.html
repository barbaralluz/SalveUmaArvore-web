{% extends "base.html" %}

{% load staticfiles %}

{% block title %}
    Listagem de Arvores
{% endblock %}

{% block content %}

  <link href="{% static 'css/style_pages.css' %}" rel="stylesheet" />
   <a href="{% url 'arvore_form' %}" class="btn btn-primary">Nova Arvore</a>
	
  <br/>
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Arvore</th>
                    <th style="width: 60px;">deletar</th>
                </tr>
            </thead>
            <tbody >
                {% for arvore in object_list %}
                <tr>
                    <td><a href="{% url 'arvore_form' arvore.pk %}">{{ arvore.nome }}</a></td>
                    <td>
                        <a href="{% url 'arvore_delete' arvore.pk %}" class="btn btn-small btn-danger">
                            X
                        </a>
                    </td>
                </tr>
                
                {% endfor %}

                </tbody>
        </table>
       
         <div  align="center" id="mapd" style="width: 900px; height: 400px;"></div> 
 
<script src="http://www.openlayers.org/api/OpenLayers.js"></script> 

 <script>

    map = new OpenLayers.Map("mapd");
    map.addLayer(new OpenLayers.Layer.OSM());
    
    epsg4326 =  new OpenLayers.Projection("EPSG:4326"); //WGS 1984 projection
    projectTo = map.getProjectionObject(); //The map projection (Spherical Mercator)
   
    var lonLat = new OpenLayers.LonLat( -47.5356, -18.2246).transform(epsg4326, projectTo);
          
    var zoom=3;
    
    var markers = new Array();
    map.setCenter (lonLat, zoom);

    var vectorLayer = new OpenLayers.Layer.Vector("Overlay");

    // Define an array. This could be done in a seperate js file.
    // This tidy formatted section could even be generated by a server-side script (jsonp)
    {% for arvore in object_list %}

       markers.push([{{arvore.longitude}}, {{arvore.latitude}}]);
    
    {% endfor %}

    //Loop through the markers array
    for (var i=0; i<markers.length; i++) {
      
       var lon = markers[i][0];
       var lat = markers[i][1];
       
        var feature = new OpenLayers.Feature.Vector(
                new OpenLayers.Geometry.Point( lon, lat ).transform(epsg4326, projectTo),
                {description: "<br>Latitude " + markers[i][1] + "<br>Longitude " + markers[i][0]},
                {externalGraphic: '/static/marker.png', graphicHeight: 45, graphicWidth: 43, graphicXOffset:-12, graphicYOffset:-36  }
            );             
        vectorLayer.addFeatures(feature);
    }                        
    
    map.addLayer(vectorLayer);

   //Add a selector control to the vectorLayer with popup functions
    var controls = {
      selector: new OpenLayers.Control.SelectFeature(vectorLayer, { onSelect: createPopup, onUnselect: destroyPopup })
    };

    function createPopup(feature) {
      feature.popup = new OpenLayers.Popup.FramedCloud("pop",
          feature.geometry.getBounds().getCenterLonLat(),
          null,
          '<div class="markerContent">'+feature.attributes.description+'</div>',
          null,
          true,
          function() { controls['selector'].unselectAll(); }
      );
      //feature.popup.closeOnMove = true;
      map.addPopup(feature.popup);
    }

    function destroyPopup(feature) {
      feature.popup.destroy();
      feature.popup = null;
    }
    
    map.addControl(controls['selector']);
    controls['selector'].activate();

  </script>          

{% endblock content %}
